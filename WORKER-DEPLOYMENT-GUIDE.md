# ğŸš€ Cloudflare Worker éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°‡å¸¶æ‚¨å®Œæˆèˆªç­ API Worker çš„éƒ¨ç½²æµç¨‹ã€‚

---

## ğŸ“‹ å‰ç½®æ¢ä»¶

- âœ… Cloudflare å¸³è™Ÿï¼ˆå·²è¨»å†Šï¼‰
- âœ… `flight-api-worker.js` æ–‡ä»¶ï¼ˆå·²åŒ…å« API Keyï¼‰

---

## ğŸ¯ æ–¹æ³•1ï¼šä½¿ç”¨ Cloudflare Dashboardï¼ˆæ¨è–¦ï¼‰

### æ­¥é©Ÿ 1ï¼šç™»å…¥ Cloudflare

1. å‰å¾€ https://dash.cloudflare.com/
2. ä½¿ç”¨æ‚¨çš„å¸³è™Ÿç™»å…¥

### æ­¥é©Ÿ 2ï¼šå‰µå»º Worker

1. é»æ“Šå·¦å´èœå–®çš„ **Workers & Pages**
2. é»æ“Šå³ä¸Šè§’çš„ **Create application**
3. é¸æ“‡ **Create Worker**
4. åœ¨ **Worker name** è¼¸å…¥ï¼š`flight-api`
5. é»æ“Š **Deploy**

### æ­¥é©Ÿ 3ï¼šç·¨è¼¯ Worker ä»£ç¢¼

1. éƒ¨ç½²å®Œæˆå¾Œï¼Œé»æ“Š **Edit code** æŒ‰éˆ•
2. åˆªé™¤ç·¨è¼¯å™¨ä¸­çš„æ‰€æœ‰é»˜èªä»£ç¢¼
3. æ‰“é–‹æœ¬åœ°çš„ `flight-api-worker.js` æ–‡ä»¶
4. **è¤‡è£½å…¨éƒ¨å…§å®¹**ï¼ˆCtrl+A â†’ Ctrl+Cï¼‰
5. è²¼åˆ° Cloudflare ç·¨è¼¯å™¨ä¸­ï¼ˆCtrl+Vï¼‰
6. é»æ“Šå³ä¸Šè§’çš„ **Save and Deploy**

### æ­¥é©Ÿ 4ï¼šç²å– Worker URL

éƒ¨ç½²æˆåŠŸå¾Œï¼Œæ‚¨æœƒçœ‹åˆ°ä¸€å€‹ URLï¼Œæ ¼å¼é¡ä¼¼ï¼š
```
https://flight-api.æ‚¨çš„ç”¨æˆ¶å.workers.dev
```

**è¤‡è£½é€™å€‹ URLï¼**

### æ­¥é©Ÿ 5ï¼šæ›´æ–°ç¶²ç«™ä»£ç¢¼

1. æ‰“é–‹æœ¬åœ°çš„ `flight-search.html`
2. æ‰¾åˆ°ç¬¬ 823 è¡Œé™„è¿‘çš„ä»£ç¢¼ï¼š
   ```javascript
   const WORKER_API_URL = 'https://flight-api.bayterter.workers.dev';
   ```
3. å°‡ URL æ›¿æ›ç‚ºæ‚¨çš„ Worker URL
4. å°‡ç¬¬ 827 è¡Œæ”¹ç‚ºï¼š
   ```javascript
   const USE_REAL_API = WORKER_API_URL !== ''; // å•Ÿç”¨çœŸå¯¦ API
   ```
5. ä¿å­˜æ–‡ä»¶ï¼Œæäº¤ä¸¦æ¨é€åˆ° GitHub

### æ­¥é©Ÿ 6ï¼šæ¸¬è©¦

1. æ¸…é™¤ç€è¦½å™¨ç·©å­˜
2. è¨ªå• `flight-search.html` é é¢
3. è¼¸å…¥èˆªç­è™Ÿï¼ˆå¦‚ `EK387`ï¼‰é€²è¡Œæ¸¬è©¦

---

## ğŸ”§ æ–¹æ³•2ï¼šä½¿ç”¨ Wrangler CLIï¼ˆé€²éšç”¨æˆ¶ï¼‰

### æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ Wrangler

æ‚¨å·²ç¶“å®‰è£äº† Wrangler v4.38.0 âœ…

### æ­¥é©Ÿ 2ï¼šç™»å…¥ Cloudflare

```bash
wrangler login
```

é€™æœƒæ‰“é–‹ç€è¦½å™¨é€²è¡Œæˆæ¬Šã€‚

### æ­¥é©Ÿ 3ï¼šå‰µå»º Worker é…ç½®

åœ¨é …ç›®æ ¹ç›®éŒ„å‰µå»º `wrangler-flight-api.toml`ï¼š

```toml
name = "flight-api"
main = "flight-api-worker.js"
compatibility_date = "2024-12-15"

[env.production]
routes = []
```

### æ­¥é©Ÿ 4ï¼šéƒ¨ç½²

```bash
wrangler deploy --config wrangler-flight-api.toml
```

### æ­¥é©Ÿ 5ï¼šæŸ¥çœ‹ Worker URL

éƒ¨ç½²æˆåŠŸå¾Œï¼Œçµ‚ç«¯æœƒé¡¯ç¤º Worker URLã€‚

---

## âš ï¸ å¸¸è¦‹å•é¡Œ

### Q1: 404 éŒ¯èª¤
**åŸå› **ï¼šWorker æ²’æœ‰æ­£ç¢ºéƒ¨ç½²
**è§£æ±º**ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥é©Ÿé‡æ–°éƒ¨ç½²

### Q2: API è¿”å›éŒ¯èª¤
**åŸå› **ï¼šAPI Key ç„¡æ•ˆæˆ–é…é¡ç”¨å®Œ
**è§£æ±º**ï¼šæª¢æŸ¥ AviationStack å¸³æˆ¶ç‹€æ…‹

### Q3: CORS éŒ¯èª¤
**åŸå› **ï¼šWorker ä»£ç¢¼ä¸­ç¼ºå°‘ CORS headers
**è§£æ±º**ï¼šç¢ºä¿ä½¿ç”¨äº†æœ€æ–°çš„ `flight-api-worker.js` ä»£ç¢¼

---

## ğŸ“Š AviationStack å…è²»æ–¹æ¡ˆé™åˆ¶

- âœ… æ¯æœˆ 100 æ¬¡ API èª¿ç”¨
- âœ… åƒ…é™æ­·å²èˆªç­å’Œç•¶å‰èˆªç­
- âŒ ä¸æ”¯æŒæœªä¾†èˆªç­é æ¸¬

**å»ºè­°**ï¼š
- ä¿ç•™æœ¬åœ°æ•¸æ“šåº«ä½œç‚ºå¾Œå‚™æ–¹æ¡ˆ
- ç›£æ§ API ä½¿ç”¨é‡ï¼ˆåœ¨ AviationStack Dashboardï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ¸¬è©¦æœ¬åœ°æ•¸æ“šåº«**ï¼š
   - ç¾åœ¨ `USE_REAL_API = false`ï¼Œå¯ä»¥ç«‹å³æ¸¬è©¦
   - æŸ¥è©¢æœ¬åœ°çš„ 11 å€‹èˆªç­

2. **éƒ¨ç½² Worker**ï¼š
   - ä½¿ç”¨ä¸Šè¿°æ–¹æ³•éƒ¨ç½² Worker
   - æ›´æ–° `flight-search.html` çš„ Worker URL

3. **æ¸…é™¤ Cloudflare ç·©å­˜**ï¼š
   - æŒ‰ç…§ `CACHE-PURGE-GUIDE.md` çš„æ­¥é©Ÿ
   - ç¢ºä¿æ‰€æœ‰è¨ªå•è€…çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬

---

## ğŸ“ æ”¯æ´

å¦‚é‡å•é¡Œï¼Œè«‹æä¾›ï¼š
- Worker URL
- éŒ¯èª¤è¨Šæ¯æˆªåœ–
- ç€è¦½å™¨ Console æ—¥èªŒ


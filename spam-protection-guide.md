# 🛡️ 垃圾訊息防護系統使用指南

## 📋 系統概覽

我們已經為您的網站實施了多層次的垃圾訊息防護系統，包含：

### 🔹 前端防護（瀏覽器端）
- ✅ **蜜罐檢測** - 隱藏欄位捕捉機器人
- ✅ **時間檢測** - 防止過快提交
- ✅ **頻率限制** - 5分鐘內防重複提交
- ✅ **內容過濾** - 檢測可疑關鍵字和模式
- ✅ **長度驗證** - 防止過短或過長的內容
- ✅ **惡意腳本防護** - 防止XSS攻擊

### 🔹 後端防護（Apps Script）
- ✅ **智能內容分析** - 多種垃圾訊息模式檢測
- ✅ **風險評分系統** - 自動評估訊息風險等級
- ✅ **自動阻擋** - 高風險內容直接阻擋
- ✅ **管理員警告** - 可疑內容自動通知
- ✅ **詳細記錄** - 完整的安全日誌

## 🚀 部署步驟

### 步驟 1：更新前端代碼

**已完成的修改**：
- ✅ 在 `script.js` 中整合垃圾訊息檢測
- ✅ 在 `聯絡我們.html` 中添加蜜罐欄位
- ✅ 加載 `enhanced-spam-protection.js` 腳本

### 步驟 2：更新 Apps Script

1. **前往 Google Sheets**：
   ```
   https://docs.google.com/spreadsheets/d/1AySXECv5cjF79YmeXY7uFwrM69-JQFG1B4MP6KD6hUU/edit
   ```

2. **更新 Apps Script**：
   - 點擊 **擴充功能** → **Apps Script**
   - 刪除所有舊代碼
   - 複製 `apps-script-with-spam-filter.js` 的內容並貼上
   - 按 **Ctrl+S** 儲存

3. **測試防護系統**：
   - 執行 `testSpamDetection()` 函數
   - 檢查垃圾訊息檢測是否正常

### 步驟 3：部署到網站

```bash
git add .
git commit -m "Add comprehensive spam protection system"
git push
```

## 🔍 防護機制詳解

### 1. 風險評分系統

每個表單提交都會獲得風險評分：

| 分數範圍 | 風險等級 | 處理方式 |
|---------|---------|---------|
| 0-7分 | 🟢 正常 | 正常處理，發送郵件 |
| 8-14分 | 🟡 可疑 | 標記為「需審核」，發送郵件但加警告 |
| 15+分 | 🔴 高風險 | 直接阻擋，不發送郵件，記錄並警告管理員 |

### 2. 檢測規則

#### 🔸 可疑關鍵字（每個 +2分）
```
推廣、優惠、免費、贈送、限時、特價、折扣、促銷
SEO、排名、網站優化、行銷、廣告、宣傳
投資、理財、股票、基金、借款、貸款、信用卡
賺錢、獲利、報酬、收益、利息
點擊、連結、加我、聯繫我、私訊、LINE、WeChat
```

#### 🔸 可疑模式（每個 +3分）
- 網址連結
- 其他Email地址
- 信用卡號格式
- 重複字符 (5個以上)
- 連續大寫字母
- 長數字串

#### 🔸 其他檢測（各種分數）
- 訊息過短/過長 (+1-4分)
- Email不一致 (+5分)
- 重複電話號碼 (+4分)
- 異常時間提交 (+3分)
- 臨時郵箱 (+5分)

### 3. 自動處理流程

```
表單提交 → 前端檢測 → 通過 → 後端分析 → 風險評分
                ↓              ↓
            不通過(阻擋)    高風險(阻擋+警告)
                              ↓
                        中風險(標記+通過)
                              ↓
                        低風險(正常處理)
```

## 📊 監控與管理

### 查看防護記錄

1. **正常提交記錄**：
   - 在 Google Sheets 的「郵件記錄」分頁
   - 包含風險評分資訊

2. **垃圾訊息記錄**：
   - 在 Google Sheets 的「垃圾訊息記錄」分頁
   - 自動創建，記錄所有被阻擋的提交

### 管理員通知

當檢測到高風險內容時，會自動發送警告郵件到：
- **主要管理員**：rayterter@hotmail.com
- **包含資訊**：風險評分、警告原因、提交者資訊

## ⚙️ 自定義設置

### 調整風險閾值

在 `apps-script-with-spam-filter.js` 中修改：

```javascript
riskThresholds: {
  block: 15,    // 15分以上直接阻擋
  review: 8,    // 8-14分標記需審核
  normal: 0     // 0-7分正常處理
}
```

### 添加/移除關鍵字

在 `SPAM_CONFIG.suspiciousKeywords` 陣列中：

```javascript
suspiciousKeywords: [
  // 添加您想要檢測的關鍵字
  '新關鍵字',
  // 移除不需要的關鍵字（直接刪除該行）
]
```

### 調整評分權重

根據您的需求調整各項檢測的分數：

```javascript
// 在前端 enhanced-spam-protection.js 中
weights: {
  keyword: 2,          // 關鍵字權重
  pattern: 3,          // 模式權重
  // ... 其他權重
}
```

## 🧪 測試垃圾訊息防護

### 前端測試

在瀏覽器 Console 中執行：

```javascript
// 測試垃圾訊息檢測
const testData = new FormData();
testData.append('name', '推廣專員');
testData.append('email', 'spam@tempmail.com');
testData.append('message', '免費SEO優化！限時優惠！');

const result = window.spamProtection.detectSpam(testData);
console.log('檢測結果:', result);
```

### 後端測試

在 Apps Script 中執行：

```javascript
// 執行 testSpamDetection() 函數
testSpamDetection();
```

## 📈 效果監控

### 關鍵指標

1. **阻擋率**：被阻擋的提交 / 總提交數
2. **誤判率**：被錯誤阻擋的正常提交
3. **管理員警告數量**：中高風險提交數量

### 定期檢查

建議每週檢查：
- 「垃圾訊息記錄」分頁中的被阻擋內容
- 是否有正常客戶被誤判
- 調整關鍵字和評分設置

## 🚨 故障排除

### 問題：正常客戶被阻擋

**解決方案**：
1. 檢查被阻擋的內容
2. 調整相關關鍵字或評分
3. 降低風險閾值

### 問題：垃圾訊息仍能通過

**解決方案**：
1. 分析通過的垃圾訊息內容
2. 添加新的關鍵字或模式
3. 提高相關檢測的評分

### 問題：系統不運作

**檢查清單**：
- [ ] Apps Script 觸發器是否正常
- [ ] JavaScript 是否有錯誤
- [ ] 網站是否載入了防護腳本

## 📞 支援

如需調整防護設置或遇到問題，請檢查：
1. 瀏覽器 Console 的錯誤訊息
2. Apps Script 的執行記錄
3. Google Sheets 中的記錄分頁

## 🎯 最佳實踐

1. **定期更新關鍵字列表**
2. **監控誤判情況**
3. **保持評分閾值適中**
4. **定期檢查防護記錄**
5. **根據實際情況調整設置**

---

**注意**：此防護系統會隨著垃圾訊息模式的變化而需要調整，建議定期檢查和更新。
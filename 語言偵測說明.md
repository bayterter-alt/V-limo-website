# 🌍 多語言自動偵測功能說明

## 目前實現的功能

網站現在支援兩種語言偵測方式：

### 1️⃣ 瀏覽器語言偵測（預設✨ - 推薦）

#### 特點
- ✅ **最快速**：無需 API 調用，立即加載
- ✅ **最準確**：尊重用戶的系統語言偏好
- ✅ **100% 可靠**：不受網路影響
- ✅ **完全免費**：無任何限制

#### 偵測邏輯（優先級由高到低）

```
1. URL 參數 (?lang=en)
   └─ 例如：https://your-site.com/?lang=en
   
2. 用戶之前的選擇 (localStorage)
   └─ 用戶上次點擊的語言按鈕
   
3. 瀏覽器語言設定 ✨
   └─ 讀取用戶的系統/瀏覽器語言
   
4. 預設繁體中文
   └─ 以上都無法判斷時的預設值
```

#### 支援的語言代碼

**英文**
- `en` → 英文
- `en-US` → 美式英文
- `en-GB` → 英式英文
- `en-AU` → 澳洲英文
- 等所有 `en-*` 變體

**中文**
- `zh-TW` → 繁體中文（台灣）
- `zh-HK` → 繁體中文（香港）
- `zh-Hant` → 繁體中文
- `zh-CN` → 簡體中文（也會顯示繁體）
- 等所有 `zh-*` 變體

#### 運作範例

**範例 1：英語系用戶**
```
瀏覽器語言：en-US
首次進入網站 → 自動顯示英文介面 ✨
Console: 🌍 瀏覽器語言設定: en-US
Console: 🌍 自動切換到：英文
```

**範例 2：台灣用戶**
```
瀏覽器語言：zh-TW
首次進入網站 → 自動顯示繁體中文介面 ✨
Console: 🌍 瀏覽器語言設定: zh-TW
Console: 🌍 自動切換到：繁體中文
```

**範例 3：用戶切換語言後**
```
1. 用戶點擊 EN 按鈕
2. localStorage 儲存 "en"
3. 下次訪問任何頁面 → 自動顯示英文 ✨
Console: 🌍 語言來源：用戶偏好 - en
```

---

### 2️⃣ IP 地理位置偵測（可選）

#### 特點
- 🌐 根據用戶的 IP 位置自動選擇語言
- ⚠️ 需要網路 API 調用（可能較慢）
- ⚠️ 使用免費 API（有每日限制）
- ⚠️ 可能不準確（VPN、代理伺服器）

#### 如何啟用

編輯 `js/i18n.js` 文件最後幾行：

```javascript
// 註釋掉方案 1
// window.i18n = new I18nManager();

// 取消註釋方案 2
window.i18n = new I18nManager({ useIPDetection: true });
```

#### 偵測邏輯

```
1. URL 參數 (?lang=en)
   └─ 最高優先級
   
2. 用戶之前的選擇 (localStorage)
   └─ 次優先級
   
3. IP 地理位置偵測 ✨
   └─ 呼叫 ipapi.co API
   └─ 獲取國家代碼（如：TW, US, HK）
   
4. 瀏覽器語言設定
   └─ IP 偵測失敗時的備案
   
5. 預設繁體中文
```

#### 地區與語言對應

**英文地區**
```javascript
['US', 'GB', 'CA', 'AU', 'NZ', 'IE', 'SG']
美國、英國、加拿大、澳洲、紐西蘭、愛爾蘭、新加坡
→ 自動顯示英文
```

**繁體中文地區**
```javascript
['TW', 'HK', 'MO']
台灣、香港、澳門
→ 自動顯示繁體中文
```

**其他地區**
```
中國大陸、日本、韓國等
→ 使用瀏覽器語言設定
```

#### 運作範例

**範例 1：美國用戶**
```
IP 位置：美國（US）
首次進入網站 → 自動顯示英文介面 ✨
Console: 🌍 正在透過 IP 偵測地理位置...
Console: 🌍 偵測到的國家/地區: US
Console: 🌍 IP 偵測：切換到英文
```

**範例 2：台灣用戶**
```
IP 位置：台灣（TW）
首次進入網站 → 自動顯示繁體中文介面 ✨
Console: 🌍 偵測到的國家/地區: TW
Console: 🌍 IP 偵測：切換到繁體中文
```

**範例 3：IP 偵測失敗**
```
網路錯誤或 API 限制
→ 自動降級使用瀏覽器語言偵測 ✨
Console: 🌍 IP 偵測失敗，使用瀏覽器語言設定
```

---

## 📊 兩種方案比較

| 項目 | 瀏覽器語言偵測 | IP 地理位置偵測 |
|------|---------------|----------------|
| **速度** | ⚡ 即時 | 🐌 較慢（API 延遲） |
| **準確度** | ✅ 高（用戶偏好） | ⚠️ 中（可能有 VPN） |
| **可靠性** | ✅ 100% | ⚠️ 取決於 API |
| **隱私** | ✅ 完全本地 | ⚠️ 發送 IP 到第三方 |
| **成本** | ✅ 免費無限制 | ⚠️ 有每日限制 |
| **離線支援** | ✅ 完全支援 | ❌ 需要網路 |

---

## 🎯 建議使用場景

### 推薦使用「瀏覽器語言偵測」（預設）

適用於：
- ✅ 大多數一般網站
- ✅ 重視速度和用戶體驗
- ✅ 尊重用戶的語言偏好
- ✅ 不想依賴第三方 API

### 使用「IP 地理位置偵測」

適用於：
- 🎯 需要根據地區提供不同服務
- 🎯 地區限定的內容或促銷
- 🎯 需要統計訪客地理分佈

---

## 💡 實際測試方法

### 測試瀏覽器語言偵測

**Chrome / Edge**
1. 設定 → 語言 → 調整語言順序
2. 清除 localStorage：`F12` → Console → 輸入 `localStorage.clear()`
3. 重新載入網站
4. 檢查 Console 的語言偵測訊息

**Firefox**
1. about:preferences → 語言 → 選擇語言
2. 清除網站資料
3. 重新載入網站

### 測試 IP 地理位置偵測

**使用 VPN**
1. 啟用 IP 偵測模式
2. 連接到不同國家的 VPN
3. 清除 localStorage
4. 重新載入網站
5. 檢查是否根據 VPN 國家切換語言

---

## 🔧 偵測日誌

所有語言偵測都會在瀏覽器 Console 中輸出日誌：

```
🌍 語言來源：URL 參數 - en
🌍 語言來源：用戶偏好 - zh-TW
🌍 瀏覽器語言設定: en-US
🌍 自動切換到：英文
🌍 正在透過 IP 偵測地理位置...
🌍 偵測到的國家/地區: TW
🌍 IP 偵測：切換到繁體中文
```

按 `F12` 開啟 Console 即可查看！

---

## ✅ 當前狀態

- ✅ 瀏覽器語言偵測（已啟用）
- ⏸️ IP 地理位置偵測（已實現，預設關閉）
- ✅ 用戶手動切換語言
- ✅ localStorage 語言記憶
- ✅ URL 參數支援

---

## 📝 備註

1. **首次訪問**：使用自動偵測
2. **再次訪問**：使用上次選擇的語言
3. **手動切換**：優先級最高，永久儲存
4. **跨頁面一致**：所有頁面使用相同語言

🎊 完美的多語言體驗！

